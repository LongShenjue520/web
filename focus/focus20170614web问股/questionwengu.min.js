!function(t,e){var i={setCookie:function(t,i){try{localStorage.setItem(t,i)}catch(a){e.Cookie.set(t,i)}},getCookie:function(t){try{return localStorage.getItem(t)}catch(i){e.Cookie.get(t)}},deleteCookie:function(t){try{localStorage.removeItem(t)}catch(i){e.Cookie.remove(t)}},getQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=encodeURI(window.location.search||window.location.href).substr(1).match(e);return null!=i?unescape(i[2]):null}},a={type:"all",askNum:0,setNum:10,UInfo:null,stock:{code:null,name:null},adviserId:null,init:function(){a.updateAskNum(function(){a.html(),a.autoLogin()},!0)},ajax:function(i,a,s,n,o,c){s=s||"json",o=o||"GET",n=n||"callback",e.ajax({type:o,url:a,dataType:s,jsonp:n,data:c||"",success:function(t){i(t)},error:function(e,i,a){t.console&&console.log&&console.log("ajax-error")}})},pop:function(t,e){JRJ.Dialogs.standardDialog({title:"",noTitle:!0,customClass:"dialog-ask-new dialog-ask-wapper",width:e||710,content:t.html(),okBtnText:"确认",cancelBtnText:"取消",hasBtn:!1,hasCloseBtn:!0,hasOkBtn:!0,hasCancelBtn:!0,okCallback:function(){},cancelCallback:function(){},isFixed:!0})},clickEvent:function(t,e,i){a.updateAskNum(function(){void 0==t?a.askall():void 0==e||i?a.askta(i||t,e):a.askstock(t,e)})},error_time1:0,error_time2:0,error:function(t){a.error_tit.text(t);var e=a.error_tit.width();a.error_tit.css({marginLeft:-e/2+"px",top:"-20px"}),a.error_tit.show(),clearTimeout(a.error_time2),clearTimeout(a.error_time1),a.error_time1=setTimeout(function(){a.error_tit.animate({opacity:1,top:a.height/2-a.error_tit.height()/2+"px"}),a.error_time2=setTimeout(function(){a.error_tit.animate({opacity:0,top:a.height+"px"},function(){a.error_tit.hide().css({top:"-20px"})})},3e3)},50)},askall:function(t,i){a.type="all",void 0!=t&&(a.type="stock"),a.pop(a.problem),a.contentInput();var s=e("#ask-block"),n=s.find(".right-cnt-list");void 0!=t&&setTimeout(function(){a.updateContent({code:t,name:i})},500),s.find("._asknum").parent().html('您今日有 <span class="highlight _asknum">'+a.setNum+"</span> 次提问机会"),a.updateAskNum(),s.find(".tit_name").text("投顾"),a.ajax(function(t){var i='<div class="tougu-list"><div class="tougu-list-tit">我要与正在直播的投顾实时交流</div><div class="tougu-list-cnt">',a="/account/adviser/",s=0;t&&t.data?(e.each(t.data,function(){s++,s>3||(i+='<div class="tougu-list-item clearfix '+(3==s?"last":"")+'"><div class="avatar"><a href="'+a+this.userid+'/" target="_blank"><img src="'+this.headImage+'"/></a></div><div class="info"><p><a href="'+a+this.userid+'/" target="_blank">'+this.username+'</a></p><div class="subject">直播主题：<a href="/live/'+this.room_id+'"target="_blank">'+this.zhibo_title+"</a></div></div></div>")}),n.html(i+"</div></div>")):n.html('<div class="tougu-single"><div class="desc" style="margin-top:100px; font-size:16px;">当前时段在线的投顾较少，请耐心等待投顾回答。<span class="quote-back"></span></div></div>')},"http://itougu.jrj.com.cn/live/index.php/service/recommendList?limit=4"),a.edit()},edit:function(){var t=i.getCookie("askQuestion");a.isAutoLogin&&a.content.val(t),i.deleteCookie("askQuestion"),e("#ask-block .row-2 .stock").click(a.addStockSearch),e("#ask-block .row-2 .btn").click(a.submit)},userChecked:!1,userChoose:function(){var t=e("#userSelect"),i=t.find(".check-txt"),s=i.find("input");t.show(),a.userChecked=!0,s.attr({checked:!0}),s.click(function(t){t.stopPropagation(),a.userChecked=!a.userChecked}),i.click(function(t){a.userChecked=!a.userChecked,a.userChecked?s.attr({checked:!0}):s.removeAttr("checked")})},askta:function(t,i){a.type="ta",a.adviserId=t,a.adviserName=i,a.ajax(function(s){if(s.ret==-1)a.alert_pop((i||"该投顾")+"暂未开启问答功能");else{a.pop(a.problem),a.userChoose(),a.contentInput();var n=e("#ask-block"),o=(e("#list-block"),n.find(".right-cnt-list")),c="/account/adviser/";n.find("._asknum").parent().html('您今日有 <span class="highlight _asknum">'+a.setNum+"</span> 次提问机会"),a.updateAskNum(),a.ajax(function(i){a.uname=i.data.username,n.find(".tit_name").text(a.uname);var s=e.getByteVal(i.data.intro||"",60),r="",l="";e.getByteLen(i.data.intro||"")>60&&(s+="...",r='<a class="link-v2 ml10" href="'+c+i.data.userid+'/" target="_blank">更多</a>'),a.ajax(function(e){1==i.data.zhibo_isopen&&(l='<p class="zhibo-title">正在直播：<a href="/live/'+e.room_id+'"target="_blank">'+i.data.zhibo_title+"</a></p>"),o.html('<div class="tougu-single"><div><div class="avatar"><a href="'+c+i.data.userid+'/" target="_blank"><img src="'+i.data.headImage+'" /></a></div></div><div class="tc mt10"><a href="'+c+i.data.userid+'/" target="_blank">'+a.uname+'</a></div><div class="desc"><p class="info">'+s+r+"</p>"+l+'</div><div class="count"><ul><li><h3>本月回答</h3><div class=\'i-count1\'><i></i><em class="month"></em></div></li><li><h3>本月有帮助</h3><div class=\'i-count2\'><i></i><em class="help"></em></div></li></ul></div></div>'),a.ajax(function(t){o.find("em.help").text(t.praiseCount)},"http://itougu.jrj.com.cn/ques/getAdviserPraiseCount.jspa?userid="+t),a.ajax(function(t){o.find("em.month").text(t.monthAnsweredTimes)},"http://itougu.jrj.com.cn/ques/monthAnsweredTimes.jspa?uid="+t),a.edit()},"http://itougu.jrj.com.cn/live/index.php/service/getRoomIdByUid/?uid="+a.adviserId)},"http://itougu.jrj.com.cn/live/index.php/service/getRoomInfoForQa?userid="+t)}},"http://itougu.jrj.com.cn/ques/isopen.jspa?tg_id="+t)},askstock:function(t,e){a.UInfo={code:t,name:e},a.stock=a.UInfo,i.deleteCookie("askQuestion"),a.askall(t,e),a.type="stock"},textNum:100,contentFn:function(t){var e=a.content,i=0;e.val()!=a.contentText&&(i=a.getLength()),i>a.textNum||i<5?a.error("请用5-100字描述问题"):t()},getLength:function(){return Math.round(e.getByteLen(a.content.val())/2)},getSelectStar:function(){return this.selectionStart?this.selectionStart:e(this).val().length},contentText:"请简要描述您的问题",contentInput:function(){a.content=e("#TextArea1"),a.error_tit=e("#ask-block .error-tit"),a.textNumValue=e("#ask-block .text-num span:eq(0)"),a.contentIndex=0,a.height=e("#ask-block").parent().height();var t=a.contentText;a.content.val(t).css({color:"#999"}).bind("focus input propertychange click",function(){e.trim(e(this).val())==t&&e(this).val("").css({color:"#666"}),a.contentIndex=a.getSelectStar.call(this),setTimeout(function(){i.setCookie("askQuestion",a.content.val());var t=a.getLength();a.textNumValue.text(t),t>a.textNum?a.textNumValue.addClass("red"):a.textNumValue.removeClass("red")},100)}),a.content.bind("blur",function(){""==e.trim(e(this).val())&&e(this).val(t).css({color:"#999"})})},updateContent:function(t){var i=t.code,s=t.name,n="$"+s+"("+i+")$",o=e("#TextArea1"),c="",r="",l="";o.click(),c=o.val(),r=c.substr(0,a.contentIndex),l=c.substr(a.contentIndex),r+=n,o.val(r+l),o.focus()},addStockSearch:function(t){t.stopPropagation();var i=e(t.target),s=i.offset().top+e(i).height()+5-e("#ask-block").offset().top;a.stockSearchHtml||(ele=e(["<div class='search-box'>","<div class='text-input'>","<input id='Text1' type='text' class='txt' placehoder='请输入股票名称/代码'><div class='sear'></div>","</div>","</div>"].join("")),a.stockSearchHtml={elem:ele,close:ele.find(".close"),closeElement:function(t){a.stockSearchHtml.elem.css({opacity:0,transform:"translateY(50px)"}),setTimeout(function(){a.stockSearchHtml.elem.remove(),a.stockSearchHtml.elem.css({transform:"translateY(50px)"}),t&&"function"==typeof t&&t()},510)},addElement:function(){var t=a.stockSearchHtml;t.elem.parent().length?t.closeElement(t.addElement):(t.elem.appendTo(e("#ask-block")),t.elem.click(function(t){t.stopPropagation()}),t.close.add(e(document)).click(function(){t.closeElement()}),setTimeout(function(){t.elem.css({left:"18px",top:s+"px",opacity:1,transform:"translateY(0px)"})},50),setTimeout(function(){a.issearch||(a.issearch=!0,a.search())},560))}}),a.stockSearchHtml.addElement()},search:function(){function t(t){t[0]&&(a.updateContent(t[0]),a.UInfo=t[0])}var i=new JRJ.ui.SearchBox("Text1",null,t,"&item=5&type=cn&typepri=s|i&areapri=cn&inc=utf8&otc=utf8",null,null,{watermark:"请输入股票名称/代码"});i._enterHandler=function(t){var i=this.container.getElementsByTagName("tr");return this.updateInputAndClist(i[this.selectedIndex],!0),e(this).blur(),this.enterEffective?this.muti?void(this.container.innerHTML=""):(this._searchHandler(t),void this.hide()):void this.hide()},i.clearInput=!1},searchList:function(t){var i=e("#ask-block"),s=e("#list-block"),n="",o="",c="",r="";a.UInfo?(c=a.UInfo.name,o="keyword="+a.UInfo.code+","+c):(r=a.content.val(),c=e.getByteVal(r,20),c+=e.getByteLen(r)>20?"...":"",o="keyword="+r),a.ajax(function(r){r&&r.data&&r.data.list&&r.data.list.length?("ta"==a.type?3==t.isOpen?s.find(".done-title").text("您的问题已经提交，48小时内"+a.adviserName+"未回答，其他投顾可以回答"):s.find(".done-title").text("您的问题已经提交，60分钟内"+a.adviserName+"未回答，其他投顾可以回答"):s.find(".done-title").text("您的问题已经提交，投顾正在为您解答！"),s.find(".search-name").text(c),s.find(".question-num").text(r.data.recordnum),e.each(r.data.list,function(){if(this.answerVo){var t=this.answerVo.content,i="",a="/ques/"+this.id+".jspa";t=t.replace(/&lt;|&amp;lt;/g,"<").replace(/&gt;|&amp;gt;/g,">").replace(/<(?![a|p](\s|>)|br|strong|img|span|font|pre|\/[a|p](\s|>)|\/br|\/strong|\/img|\/span|\/font|\/pre)[^>]+>/gi,"").replace(/style=["]([^"]*|\s*)["]/gi,"").replace(/style=[']([^']*|\s*)[']/gi,""),t=t.replace(/\s+|(&nbsp;)+/g," "),t=t.replace(/(.*?)<(\/br|br\s*.*?|br \/)>/g,"<p>$1</p>"),t=t.replace(/<[\/?abc|e-h|j-o|q-t]\w*\s*[=-]*['"]*['"]*>/gi,""),t=t.replace(/<img[\w|\s]*>/gi,""),t=t.replace(/(&nbsp)+;*/gi,""),t=t.replace(/<p[\x21-\x2f|\x3a-\x3b|=|\x3f-\x40|\w|\s|\u4e00-\u9fa5|\u0391-\uFFE5]*>/gi,"<p>"),t=t.replace(/<[\/|a-z][\x21-\x2f|\x3a-\x3b|=|\x3f-\x40|\w|\s|\u4e00-\u9fa5|\u0391-\uFFE5]*>/gi,""),t=t.replace(/<\w+\s*>\s*<\/\w+\s*>/gi,""),i=e.getByteVal(t,170),i=this.answerVo.adviserUser.userName+"已回答该问题，<a  style='color:#3c9af2;' target='_blank' href='"+a+"'>点击查看>></a>",n+='<div class="scroll-list-item"><div class="clearfix ansertit"><dl class="highlight"><dd><i class="i-wen"></i></dd><dt><a target="_blank" href='+a+">"+this.content+'</a></dt></dl></div><dl class="answer-cnt"><dd><i class="i-da"></i></dd><dt>'+i+"</dt></dl></div>"}}),s.find(".scroll-list").html(n),s.find(".look-all").attr("href","/search/?"+o+"&type=ask"),s.find(".ok-btn-scusses").unbind().click(function(){window.location.href="/ques/service/advice.jspa"}),s.find(".btn-reverse").unbind().click(function(){JRJ.Dialogs.close()}),s.find(".red").removeClass("red"),i.animate({opacity:0,marginTop:-a.height+"px"},function(){i.hide()}),s.show()):a.zhiboshow(!0,t)},"http://itougu.jrj.com.cn/search/api?"+o+"&type=ask&start=0&size=5")},zhiboshow:function(t,i){var s="/account/adviser/",n=580;if(0==a.askNum){var o=a.askNum?"<p>您今日剩余 "+a.askNum+" 次提问机会</p>":"您今日提问机会已经用完";return void a.alert_pop(o)}"all"==a.type||"stock"==a.type?a.ajax(function(i){if(i.data&&i.data.length){1==i.data.length&&(n=380),a.pop(a.zhiboata,n);var o='<div class="tougu-list-2 clearfix">',c=0,r="",l="",d=e(".dialog-ask-new-inner"),u=d.find(".tit-2"),p=d.find(".tgtitle"),h=d.find(".btn-wrap");u.html('<p><i class="i-search-success"></i>您的问题已经提交，投顾正在为您解答！</p>'),p.text("您可与正在直播的投顾实时交流，解决您的疑问！"),e.each(i.data,function(){c++,c>4||(r='<a href="'+s+this.userid+'/" target="_blank"',l='<a href="/live/'+this.room_id+'"target="_blank"',(c+1)%2==0&&1!=c&&(o+='<div class="line"></div>'),o+='<div class="tougu-list-2-item"><div class="avatar">'+r+'><img src="'+this.headImage+'"/></a></div><div class="info"><p>'+l+' class="zhibo_btn">看TA直播</a>'+r+">"+this.username+'</a></p><div class="subject">正在直播：'+l+">"+this.zhibo_title+"</a></div></div></div>")}),o+="</div>",e(".dialog-ask-new-inner .itougu-box").css({marginTop:"10px"}).append(o)}if(t){i.data||a.pop(a.zhiboata,380);var o='<div class="tougu-list-2 clearfix">',d=e(".dialog-ask-new-inner"),u=d.find(".tit-2"),p=d.find(".tgtitle"),h=d.find(".btn-wrap");i.data||(o='<div style="text-align:center; padding-bottom:20px; color:#666;">当前暂无直播</div>',e(".dialog-ask-new-inner .itougu-box").css({marginTop:"10px"}).append(o)),u.html('<p><i class="i-search-success"></i>您的问题已经提交，投顾正在为您解答！</p>'),p.hide(),h.show(),h.find(".ok-btn-scusses").unbind().click(function(){window.location.href="http://itougu.jrj.com.cn/ques/service/advice.jspa"}),h.find(".btn-reverse").unbind().click(function(){JRJ.Dialogs.close()})}},"http://itougu.jrj.com.cn/live/index.php/service/recommendList?limit=4"):a.ajax(function(n){if(n&&n.data){if(n.data.zhibo_isopen<1)return a.type="all",a.zhiboshow(t,i);a.pop(a.zhiboata,380);var o=e(".dialog-ask-new-inner"),c=o.find(".tit-2"),r=o.find(".tgtitle"),l=o.find(".btn-wrap"),d="";a.ajax(function(t){d='<a href="/live/'+t.room_id+'"target="_blank"',r.text("您可参与"+n.data.username+"的直播，与TA实时交流，解决您的疑问！"),o.find(".itougu-box").append('<div class="tougu-single-2 clearfix" style="padding:10px 0"><div class="avatar"><a href="'+s+n.data.userid+'/" target="_blank"><img src="'+n.data.headImage+'"></a></div><div class="info"><p>'+d+'class="zhibo_btn">看TA直播</a><a href="'+s+n.data.userid+'/" target="_blank">'+n.data.username+'</a></p><div class="subject">正在直播：'+d+">"+n.data.zhibo_title+"</a></div></div></div>")},"http://itougu.jrj.com.cn/live/index.php/service/getRoomIdByUid/?uid="+a.adviserId),t&&(i&&3==i.isOpen?c.html('<p><i class="i-search-success"></i>您的问题已经提交</p><p style="padding:10px 0; font-size:15px; ">48小时内"'+n.data.username+'"未回答，其他投顾可以回答</p>'):c.html('<p><i class="i-search-success"></i>您的问题已经提交</p><p style="padding:10px 0; font-size:15px; ">60分钟内"'+n.data.username+'"未回答，其他投顾可以回答</p>'),r.hide(),l.show(),l.find(".ok-btn-scusses").unbind().click(function(){window.location.href="http://itougu.jrj.com.cn/ques/service/advice.jspa"}),l.find(".btn-reverse").unbind().click(function(){JRJ.Dialogs.close()}))}},"http://itougu.jrj.com.cn/live/index.php/service/getRoomInfoForQa?userid="+a.adviserId)},alert_pop:function(t){JRJ.Alerts.alert({title:"提示",message:t,autoClose:!1,okCallback:function(){},cancelCallback:function(){}})},unBind:function(t,i,a){var s=e(this),a=a||3e3,i=i||"click",n=0,o={unbind:function(){n++,n>a/1e3?o.bind():(s.addClass("gray").unbind(),setTimeout(o.unbind,a))},bind:function(){s.removeClass("gray").bind(i,t)}};return o},submit:function(){var t=this;a.contentFn(function(){var i=membership.getUserInfo().userId;if(i)a.updateAskNum(function(){var i="all"!=a.type?"2":"1",s=a.content.val(),n=membership.getUserInfo();1==a.userChecked&&(i=3),a.unBind.call(t,a.submit).unbind(),e.ajax({url:"http://itougu.jrj.com.cn/ques/saveAsk.jspa",type:"post",data:{currentUser:n.userId,cont:s,textcont:s,answer_user_id:a.adviserId||"",isopen:i},success:function(t){if(1==t.ret)a.UInfo={code:t.stock,name:t.stockname};else if(t.ret==-1)return a.alert_pop(t.msg);a.searchList(t)},error:function(){a.alert_pop("提问失败")}})});else{var s=JRJ.ui.isLogin(),n="",o="",c="&askType="+a.type;a.UInfo&&(n="&keyword="+a.UInfo.code+","+encodeURI(a.UInfo.name)),"ta"==a.type&&(o="&askId="+a.adviserId),window.membership.href=window.location.href+"#openAskQuestion=true"+n+o+c,s.isLoginCallback=function(){s.close(),window.membership.update(),a.updateAskNum(function(){})}}})},updateAskNum:function(t,i){membership.getUserInfo().userId?a.ajax(function(s){if(a.askNum=parseInt(s.askTimes),a.setNum=a.setNum<0?0:a.setNum,e("#ask-block ._asknum").parent().html('您今日剩余 <span class="highlight _asknum">'+a.askNum+"</span> 次提问机会"),a.askNum)t&&t();else{if(i)return;a.zhiboshow()}},"http://itougu.jrj.com.cn/ques/askTimes.jspa"):t&&t()},html:function(){a.problem=e(['<div><div class="dialog-ask-new-inner clearfix">','<div id="ask-block">','<div class="dialog-ask-new-left">','<div class="inner">','<div class="tit clearfix">','<span class="fr">您今日剩余 <span class="highlight _asknum"></span> 次提问机会</span>','<span>向<span class="tit_name"></span>提问</span>',"</div>",'<div class="row-1">','<div><textarea id="TextArea1"></textarea></div>',"</div>",'<div class="row-2">','<a class="btn btn-89-31">提交</a>','<div class="text-num"><span>0</span><span>/'+a.textNum+'</span></div><span class="stock"><i></i>股票</span>',"</div>",'<div id="userSelect" class="row-3" style="display:none">','<div class="check-txt" style="cursor:pointer; height:25px; line-height:25px;"><input style="vertical-align:top; margin-top:7px; margin-right:5px;" type="checkbox" checked>48小时内不允许其他投顾回答</div>',"</div>",'<div class="clearfix qq-sever">签约和开户问题请咨询客服 <a href="http://wpa.b.qq.com/cgi/wpa.php?ln=1&key=XzgwMDA4OTg4N18xNjM0NzRfODAwMDg5ODg3XzJf" class="link-v2" target="_blank">在线咨询</a></div>','</div><div class="error-tit" style="display:none"></div>',"</div>",'<div class="dialog-ask-new-right">','<div class="inner right-cnt-list"></div>',"</div>","</div>",'<div id="list-block" style="display:none;">','<div class="tit-2 tc clearfix">','<span><i class="i-search-success"></i><span class="done-title">您的问题已经提交，投顾正在为您解答！</span></span>',"</div>",'<div class="sub-tit clearfix">','<a class="fr link-v2 look-all" target="_blank">查看全部</a>','<span>看看与 <span class="highlight search-name"></span> 有关的回答吧，共 <span class="question-num"></span> 条</span>',"</div>",'<div class="scroll-list"></div>','<div class="btn-wrap" style="padding:15px 0;">','<span class="btn btn-89-31 ok-btn-scusses">查看我的提问</span>','<span class="btn btn-89-31 btn-reverse">关闭</span>',"</div>","</div>","</div></div>"].join(""));var t=a.askNum?"<span>您今日剩余 "+a.askNum+" 次提问机会</span>":"您今日提问机会已经用完！";a.zhiboata=e(['<div><div class="dialog-ask-new-inner clearfix">','<div class="tit-2 clearfix">'+t+"</div>",'<div class="itougu-box clearfix">','<div class="tgtitle"></div>',"</div>",'<div class="btn-wrap" style="padding:20px 0; display:none;">','<span class="btn btn-89-31 ok-btn-scusses">查看我的提问</span>','<span class="btn btn-89-31 btn-reverse">关闭</span>',"</div>","</div></div>"].join(""))},isAutoLogin:!1,autoLogin:function(){var t,s=document.location||location,n=s.href,o=i.getQueryString("keyword"),c=i.getQueryString("userId"),r=i.getQueryString("askId"),l=i.getQueryString("askType");n.search("openAskQuestion=true")>-1&&a.updateAskNum(function(){a.isAutoLogin=!0,o=o?o.split(","):o,o&&(t=o[1],o=o[0].substr(-6),t="ta"==l?decodeURI(t):"all"==l?decodeURI(decodeURI(t)):decodeURI(t),a.UInfo={name:t,code:o}),e(function(){a.clickEvent(o||c,t,r),location.hash=""})})}};a.init(),t.Question=a}(window,$);