<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>战队赛排行榜</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="keywords" content="战队详情" />
    <meta name="description" content="战队详情" />
    <script src="http://i0.jrjimg.cn/zqt-red-1000/focus/focus_zixuangu/flexible.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/css/team_list.css?v=2"> -->
    <!-- <link rel="stylesheet" type="text/css" href="css/team_list.css"> -->
    <style type="text/css">
@charset "utf-8";
/* CSS Document */
body, div, p, h1, h2, h3, h4, h5, h6, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, table, th, td { margin: 0; padding: 0; }
body, button, input, select, textarea { font:12px/24px "Microsoft YaHei","微软雅黑",simsun,"宋体",tahoma,arial; }
h1, h2, h3, h4, h5, h6 { font-size: 100%; }
address, cite, em, i { font-style: normal; }
li { list-style: none; }
a { text-decoration: none; }
a:link { text-decoration: none; }
a:active{  background:none !important;  }
legend { color: #000; }
fieldset, img { border: 0; }
button, input, select, textarea { font-size: 100%; line-height: normal; }
table { border-collapse: collapse; border-spacing: 0; }
input[type="button"], input[type="submit"], input[type="reset"] { cursor: pointer; }
.clearfix:after, .wrapper:after { visibility: hidden; display: block; font-size: 0; content: " "; clear: both; height: 0; }
/* start commented backslash hack \*/
* html .clearfix { height: 1%; }
.clearfix { display: block; }
/* close commented backslash hack */
body { margin: 0; padding: 0;  background: #efeff4;-webkit-tap-highlight-color:rgba(0,0,0,0);}
.fl{float: left;}.fr{float: right;}
.disnone{  display: none;}
.fall {color: #2DC678 !important;}
.up {color: #F24637 !important;}
.outer{width: 100%;}
/*头部*/
.outer .tab{width: 100%;height: 1.44rem;border-top: 1px solid #e6e6e6;position: fixed;top: 0;z-index: 9;background: #efeff4; }
.outer .tab>li{width: 50%;height: 1.1733rem; float: left;margin-top: 0.2667rem;background: #fff;line-height: 1.1733rem;text-align: center;font-size: 0.3733rem;position: relative;}
.outer .tab>li>.li_cur{display: block;width: 0.6667rem;height: 0.0533rem;background: #ff4040;position: absolute;bottom: 0;left: 50%;margin-left: -0.3333rem;}
.tabCom{}
/*战队信息*/
.team_list{height: 4.7733rem;background-color: #fff;padding-left: 0.4rem;padding-right: 0.4rem;border-top: 1px solid #e6e6e6; }
.team_header{width: 100%;height: 0.88rem;padding-top: 0.48rem;}
.team_header>i{width: 0.5067rem;height: 0.56rem;display: block;color: #888888;background-color: #dfdfdf;font-size: 0.3467rem;line-height:0.62rem;float: left;text-align: center;}
.colorRed{color: #ff4040;}
.team_list:first-child .team_header>i{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus20170214caogu/h5/img/redno1.png');background-size: 0.5067rem 0.56rem;float: left; text-indent: -999px;}
.team_list:first-child +.team_list .team_header>i{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus20170214caogu/h5/img/redno2.png');background-size: 0.5067rem 0.56rem;float: left;  text-indent: -999px;}
.team_list:first-child +.team_list +.team_list .team_header>i{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus20170214caogu/h5/img/redno3.png');background-size: 0.5067rem 0.56rem;float: left;  text-indent: -999px;}
.teamNumberOne{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/teamNumberOne.png');background-size: 0.5067rem 0.56rem;float: left; }
.teamNumberTwo{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/teamNumberTwo.png');background-size: 0.5067rem 0.56rem;float: left; }
.teamNumberThree{display: block;width: 0.5067rem;height: 0.56rem;background: url('http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/teamNumberThree.png');background-size: 0.5067rem 0.56rem;float: left; }
.team_header>p{font-size: 0.4533rem;line-height: 0.4667rem; color: #333333;font-weight: 600;float: left;margin-left: 0.3333rem;}
.team_header>img{width: 1.3333rem;height: 0.4267rem;margin-left: 0.1067rem;display: block;float: left;}
.team_list ul{width: 100%;height: 1.9467rem;background: #f7f7f7;}
.team_list ul li{width: 33.33%;float: left;text-indent: 0.5333rem;padding-top: 0.4267rem;height: 1.0133rem;position: relative;}
.team_list ul li p{font-size: 0.32rem;line-height: 0.3333rem;color: #888888;margin-top: 0.2667rem;position: absolute;bottom: 0;}
.team_list ul li:first-child span{font-size: 0.5867rem;color: #333333;font-weight: 600;}
.team_list ul li:first-child +li span,.team_list ul li:first-child +li +li span{font-size: 0.4267rem;color: #333333;margin-top: 0.1067rem;display: block;line-height: 0.43rem;}
.team_leader{width: 100%;height: 1.0667rem;padding-top: 0.4rem;}
.team_leader>div{width: 0.64rem;height: 0.64rem;border-radius: 50%;background-color: red;float: left;overflow: hidden;}
.team_leader>div>img{width: 0.64rem;height: 0.64rem;}
.team_leader>p{font-size: 0.3733rem;line-height: 0.64rem;color: #333333;margin-left: 0.2133rem; float: left;}
.team_leader>span{display: block;height: 0.7467rem;width: 2.6667rem;background: url("http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/joinTeam.png") no-repeat;background-size: 100% 100%; float: right;font-size: 0.32rem;color: #fff;line-height: 0.7467rem;text-align: center;}
.user_ranking{width: 0.507rem;height: 0.587rem;border-radius: 0.107rem;font-size: 0.373rem;color: #888888;background: #f0f0f0;line-height: 0.587rem;text-align: center;margin-top: 0.32rem;margin-right:0.267rem;overflow: hidden;}

   .loadMore{font-size: 0.32rem;text-align: center;line-height: 0.5rem;}
.team_leader>.join_this_team{display: block;height: 0.7467rem;width: 2.6667rem;background: url("https://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/joinTeam.png") no-repeat;background-size: 100% 100%; float: right;font-size: 0.32rem;color: #fff;line-height: 0.7467rem;text-align: center;margin-top: -0.07rem;}
.team_leader>.join_me_team{display: block;height: 0.7467rem;width: 2.6667rem;background: url("https://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/join_me_team.png") no-repeat;background-size: 100% 100%; float: right;font-size: 0.32rem;color: #fff;line-height: 0.7467rem;text-align: center;margin-top: -0.07rem;}
.warn_over{width: 5rem; position: fixed;left: 50%;bottom: 10%; z-index: 15;font-size: 0.4rem;line-height: 0.4rem; height: 0.4rem ;margin-left: -2.5rem;background-color: #282001;text-align: center;border-radius: 0.1rem;color: #fff;opacity: 0.8;padding: 0.2rem 0;}  
/*._v-container>._v-content>.pull-to-refresh-layer[data-v-ecaca2b0]{margin-top: -1.42rem !important;}*/
/*._v-container>._v-content>.loading-layer .spinner-holder .arrow[data-v-ecaca2b0], ._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .arrow[data-v-ecaca2b0]{width: 0.5rem !important;height: 0.5rem !important;}
._v-container>._v-content>.loading-layer .spinner-holder .text[data-v-ecaca2b0], ._v-container>._v-content>.pull-to-refresh-layer .spinner-holder .text[data-v-ecaca2b0]{font-size: 0.26rem !important;}*/
.gif{display: block;width:2.9333rem;height: 2.4533rem;margin: 0 auto;margin-top: 40%; }
.innerBox{display: none;}
    </style>
</head>
<body>
	<div class="outer" id="app">
		<div class="warn_over disnone">不能离开战队</div>
		<ul class="clearfix tab">
			<li @click="clickLi" className="total" class="colorRed">总收益<span class="li_cur"></span></li>
			<li @click="clickLi" className="month">月收益<span></span></li>
		</ul>	
	<scroller :on-refresh="refresh" :on-infinite="infinite"
    style="margin-top: 1.48rem;">
    	<img src="http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/gif0.gif" class="gif">
    	<div class="innerBox">
    		<div class="tab_total">
				<div class="team_list " v-for="item in totalList">
					<div class="team_header"   :teamId="item.teamId"  @click="goTeamDetail" >
						<i>{{item.totalRank}}</i>
						<p>{{item.teamName}}</p>
						<img :src="dableMoney[item.advantage]" v-show="item.advantage != 1">
					</div>
					<ul   :teamId="item.teamId"  @click="goTeamDetail" >
						<li>
							<span :class="{up:(item.totalProfit > 0),fall:(item.totalProfit < 0)}" >{{item.totalProfit.toFixed(2)}}%</span>
							<p>总收益</p>
						</li>
						<li>
							<span v-bind="item.membersNum">{{item.membersNum}}</span>
							<p>成员数</p>
						</li>
						<li>
							<span>{{item.tradeCapital.toFixed(2)}}万</span>
							<p>操盘金</p>
						</li>
					</ul>
					<div class="team_leader">
						<div  @click="goLeader"  :tgId="item.tgPassportId"><img :src="item.tgHeadUrl"></div>
						<p @click="goLeader"  :tgId="item.tgPassportId">{{item.tgName}}</p>
		                <span class="join_this_team" v-show="item.isMyTeam==0"  :teamId="item.teamId" @click="jointhisTeam"></span>
		                <span class="join_me_team"  v-show="item.isMyTeam==1"  :teamId="item.teamId"  @click="goTeamDetail" ></span>
					</div>
				</div>	    			
    		</div>

			<div class="tab_month  disnone">
				<div class="team_list" v-for="item in monthList">
					<div class="team_header"   :teamId="item.teamId"  @click="goTeamDetail" >
						<i>{{item.totalRank}}</i>
						<p>{{item.teamName}}</p>
						<img :src="dableMoney[item.advantage]" v-show="item.advantage != 1">
					</div>
					<ul   :teamId="item.teamId"  @click="goTeamDetail" >
						<li>
							<span :class="{up:(item.totalProfit > 0),fall:(item.totalProfit < 0)}">{{item.totalProfit.toFixed(2)}}%</span>
							<p>总收益</p>
						</li>
						<li>
							<span>{{item.membersNum}}</span>
							<p>成员数</p>
						</li>
						<li>
							<span>{{item.tradeCapital.toFixed(2)}}万</span>
							<p>操盘金</p>
						</li>
					</ul>
					<div class="team_leader">
						<div   @click="goLeader"  :tgId="item.tgPassportId"><img :src="item.tgHeadUrl"></div>
						<p @click="goLeader"  :tgId="item.tgPassportId">{{item.tgName}}</p>
		                <span class="join_this_team" v-show="item.isMyTeam==0"   :teamId="item.teamId"  @click="jointhisTeam"></span>
		                <span class="join_me_team"  v-show="item.isMyTeam==1"  :teamId="item.teamId"  @click="goTeamDetail" ></span>
					</div>
				</div> 				
			</div>
  		
    	</div>
	</scroller>	
	</div>
<script src="http://js.jrjimg.cn/zqt-red-1000/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src='https://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/js/vue.min.js'></script>
<script type="text/javascript" src='https://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/vue-scroller.min.js'></script>
<script>
	var app = new Vue({
		el:'#app',
		data:{
			totalList:[],
			monthList:[],
			total:false,
			month:false,
			dableMoney:{
				5:"http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/fiveMoney.png",
				3:"http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/threeMoney.png",
				2:'http://i0.jrjimg.cn/zqt-red-1000/focus/focus2017YMZ/teamFrighting/img/twoMoney.png'
			},
			teamNumber:{
				1:"teamNumberOne",
				2:"teamNumberTwo",
				3:"teamNumberThree"
			},
			teamMontnNumber:{
				1:"teamNumberOne",
				2:"teamNumberTwo",
				3:"teamNumberThree"
			},
			currentNumTotal:1,
            currentNumMonth:1,
            ssoId:"0",
            token:'0'
		},
		beforeCreate:function(){},
		created:function(){},
		computed:{},
		mounted:function(){
				this.loadRefresh();
			},
		methods:{
			loadRefresh:function(){

				var that = this;
				var ssoId = '$!{ssoId}'; 
                var token = '$!{spToken}';
                if(ssoId=="null"){
					ssoId = window.localStorage.getItem("ssoId");
					token = window.localStorage.getItem("token");        	
                } 
                that.ssoId = ssoId;
                that.token = token;
				// 总排行
				$.ajax({
					url: 'http://itougu.jrj.com.cn/match/v7/team/queryTeamList.jspa',
					type: 'get',
					dataType: 'json',
					data:{
						ranktype:4,
						currentNum:1,
						pageSize:10,
						needMyTeam:1
					},
					beforeSend:function(xhr){
	                xhr.setRequestHeader('passportId', ssoId,xhr.setRequestHeader('accessToken', window.token))
	                },
					success:function(jsondata){
						if(jsondata.retCode=='0'){
							that.totalList=jsondata.data.items;
						}
					}
				})
				//  月排行
				$.ajax({
					url: 'http://itougu.jrj.com.cn/match/v7/team/queryTeamList.jspa',
					type: 'get',
					data:{
						ranktype:3,
						currentNum:1,
						pageSize:10,
						needMyTeam:1
					},
					beforeSend:function(xhr){
	                xhr.setRequestHeader('passportId', ssoId,xhr.setRequestHeader('accessToken', token))
	                },
					dataType: 'json',
					success:function(jsondata){
						console.log(window.passportId,window.accessToken)
						console.log(JSON.stringify(jsondata)  )
						if(jsondata.retCode=='0'){
							that.monthList=jsondata.data.items;
						}
					}
				})
				setTimeout(function(){
						$(".gif").hide();
						$('.innerBox').show();			
					},1000)
			},
			clickLi:function(){
                $(event.currentTarget).addClass('colorRed').find("span").addClass('li_cur');
                $(event.currentTarget).siblings().removeClass('colorRed').find("span").removeClass('li_cur');
                var thatName = ".tab_"+$(event.currentTarget).attr('className');
                var num = thatName.split(' ');
                $(num[0]).fadeIn("fast").siblings().fadeOut("fast");
            },
            infinite:function(done){
                var url = 'http://itougu.jrj.com.cn/match/v7/team/queryTeamList.jspa';
                var ranktype;         
                var that = this;
                var currentNum = 1;
                var teamId = this.teamId;  
                // 判断当前是总收益还是月收益
                setTimeout(function () {
		                if($('.tab_total').css('display')=="block"){//当前是总收益
		                    ranktype=4;
		                    currentNum = that.currentNumTotal;
		                }else if($('.tab_month').css('display')=="block"){//月收益
		                    ranktype=3;
		                    currentNum = that.currentNumMonth;
		                }   
		                // 总收益
		                currentNum++;
		                $.ajax({
		                    url:  url,
		                    type: 'get',
		                    data:{
		                        ranktype:ranktype,
		                        currentNum:currentNum,
		                        pageSize:10,
		                        needMyTeam:1
		                    },
		                    dataType: 'json',
		                    success:function(jsondata){
		                        console.log(jsondata)
		                        if(jsondata.retCode=="0"){
		                            if(ranktype==4){
		                                that.currentNumTotal=currentNum;
		                                if(jsondata.data.items.length <= 10){
	                                        setTimeout(function(){
	                                        	done(true)
	                                        },1500)
	                                        return;
		                                }   
		                                for(var i = 0 ;i < jsondata.data.items.length ; i++){
		                                    that.list.push(jsondata.data.items[i]);
		                                } 
		                                
		                            }else{
		                            	console.log( that.currentNumMonth)
		                                that.currentNumMonth=currentNum;

		                                if(jsondata.data.items.length <= 10){
	                                        setTimeout(function(){
	                                        	done(true)
	                                        },1500)
	                                        return;
		                                }                                    
		                                for(var i = 0 ;i < jsondata.data.items.length ; i++){
		                                    that.monthList.push(jsondata.data.items[i]); 
		                                }
		 
		                            }

		                        }
		                    }
		                }) 
	              	done();
	            }, 1500)  
            },
            refresh: function (done) {
                var self = this;
                setTimeout(function () {
                    self.loadRefresh();
                    done();
                }, 1500)
            },
            goTeamDetail:function(){
              var teamId = $(event.currentTarget).attr('teamId');
              window.location.href='http://itougu.jrj.com.cn/activity/app/team_detail.jspa?teamId='+teamId+''
            },
            jointhisTeam:function(){
	            // 参加战队
	          var self = this ;
	          if(window.localStorage.getItem("ssoId") != "null"){
	              var ssoId = window.localStorage.getItem("ssoId");
	              var token = window.localStorage.getItem("token");
	              var teamId = $(event.currentTarget).attr('teamId');
	              var ssoId = '$!{ssoId}'; 
                  var token = '$!{spToken}';
	              console.log(ssoId,token,teamId)
	              $.ajax({
	               url: ' http://itougu.jrj.com.cn/match/v7/team/joinTeam.jspa',
	               type: 'get',
	               data:{
	                 userId:String(ssoId),
	                 teamId:teamId
	               },
	               dataType: 'json',
	               success:function(jsondata){ 
	                 console.log(jsondata)
	                 if(jsondata.retCode=='0'){
	                    $('.warn_over').html("报名成功！")
	                    $('.warn_over').show();
	                          setTimeout(function(){
	                              $('.warn_over').fadeOut();
	                              self.loadRefresh();
	                          },2000); 
	                    window.location.reload();
	                 }else{
	                    $('.warn_over').html(jsondata.msg)
	                    $('.warn_over').show();
	                          setTimeout(function(){
	                              $('.warn_over').fadeOut();
	                         },2000); 
	                 }
	               }
	              })
	            }else{
	               jrj.jsCallNative('108', JSON.stringify({ returnUrl: encodeURI(window.location.href) }));
	            }
            },
            goLeader:function(){
              // 去投顾主页
              var tgId = $(event.currentTarget).attr("tgId");
              jrj.jsCallNative("113",JSON.stringify({id:tgId})) 
            },



		}
	})

</script>
</body>
</html>