window.CouponDlg=function(){var e="http://itougu.jrj.com.cn/order/showbuyweb.jspa?pid={pid}&orderType={type}",t="http://itougu.jrj.com.cn/order/buyweb.jspa?pid={pid}&cid={cid}&orderType={type}&month={month}",n="http://itougu.jrj.com.cn/order/showbuyweb2.jspa?pid={pid}&orderType={type}&tgid={tgid}&num={num}&rmb={rmb}&content={content}",a="http://itougu.jrj.com.cn/order/buyweb2.jspa?pid={pid}&cid={cid}&orderType={type}&tgid={tgid}&num={num}&rmb={rmb}&uniqueid={uniqueid}",s="http://itougu.jrj.com.cn/order/buyweb8.jspa?pid={pid}&cid={cid}&orderType={type}&tgid={tgid}&num={num}&rmb={rmb}&uniqueid={uniqueid}&content={content}",i=['<div class="dialog-cnt">','<div class="product-desc">',"<h2>{{tname}}：{{pname}}</h2>","{{#ismaster}}","<p>比赛时间：{{startTime}} 至 {{endTime}}</p>","{{/ismaster}}","{{^ismaster}}","{{#isGlance}}",'<p>偷看时长：<span class="red">30</span> 分钟</p>',"{{/isGlance}}","{{^isGlance}}","<p>最长周期：{{startTime}} 至 {{endTime}}</p>","{{/isGlance}}","{{/ismaster}}","{{#isGlance}}",'<p>偷看价格：<span class="red">{{amount}}</span> 元',"{{/isGlance}}","{{^isGlance}}",'<p>订阅价格：<span class="red">{{amount}}</span> 元</p>',"{{/isGlance}}","</div>",'<div id="coupon-list" class="coupon-list"></div>','<p class="note">{{note}}</p>','<p class="agreement middle"><input id="chkAgreement" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/risk.html" target="_blank">风险揭示书</a><span>》</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=agreement" target="_blank">服务使用协议</a><span>》</span></p>','{{#orgId}}<p class="agreement middle"><input id="chkAgreement2" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=trader_{{orgId}}" target="_blank">{{agreementName}}</a><span>》</span></p>{{/orgId}}','<div class="btn-wrap clearfix">','<a id="btnCouponPay" href="" class="btn btn-89-31 fr">立即支付</a>','<span class="price">实付款：<span id="finalPrice" class="red">{{amount}}</span>元</span><span id="notice" class="red ml5" style="display:none;">优惠券购买商品多出金额不予退还</span>',"</div>","</div>"].join(""),c=['<div class="dialog-cnt">','<div class="product-desc">',"<h2>{{tname}}：{{pname}}</h2>",'<ul class="long-term-month" id="long-term-month"></ul>','<p class="long-term-p">服务周期：<span class="start-time">{{startTime}}</span> 至 <span class="end-time">{{endTime}}</span></p>','<p class="long-term-p" id="original-disc">订阅价格：<span class="red disc">{{amount}}</span> 元<del class="line"></del></p>',"</div>",'<div id="coupon-list" class="coupon-list"></div>','<p class="note">订阅须知：此内容仅代表个人研究成果，供学习参考，不是投资依据，据此操作风险自担。</p>','<p class="agreement middle"><input id="chkAgreement" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/risk.html" target="_blank">风险揭示书</a><span>》</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=agreement" target="_blank">服务使用协议</a><span>》</span></p>','{{#orgId}}<p class="agreement middle"><input id="chkAgreement2" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=trader_{{orgId}}" target="_blank">{{agreementName}}</a><span>》</span></p>{{/orgId}}','<div class="btn-wrap clearfix">','<a id="btnCouponPay" href="" class="btn btn-89-31 fr">立即支付</a>','<span class="price">实付款：<span id="finalPrice" class="red">{{amount}}</span>元</span><span id="notice" class="red ml5" style="display:none;">优惠券购买商品多出金额不予退还</span>',"</div>","</div>"].join(""),r=['<div class="dialog-cnt">','<div class="product-desc"><h2>支付项目：{{pname}}</h2><p>价格：<span class="red">{{amount}}</span> 元</p></div>','<div id="coupon-list" class="coupon-list"></div>','<p class="note">{{note}}</p>','<p class="agreement middle"><input id="chkAgreement" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/risk.html" target="_blank">风险揭示书</a><span>》</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=agreement" target="_blank">服务使用协议</a><span>》</span></p>','{{#orgId}}<p class="agreement middle"><input id="chkAgreement2" type="checkbox" checked="checked" /><span>我已阅读并同意</span><span>《</span><a class="link-v2" href="http://itougu.jrj.com.cn/site/help.html?tag=trader_{{orgId}}" target="_blank">{{agreementName}}</a><span>》</span></p>{{/orgId}}','<div class="btn-wrap clearfix">','<a id="btnCouponPay" href="" class="btn btn-89-31 fr">立即支付</a>','<span class="price">实付款：<span id="finalPrice" class="red">{{amount}}</span>元</span><span id="notice" class="red ml5" style="display:none;">优惠券购买商品多出金额不予退还</span>',"</div>","</div>"].join(""),o=['<div class="tit"><a href="http://itougu.jrj.com.cn/site/help.html?tag=coupon" class="fr link-v2" target="_blank">[了解优惠券规则]</a>可用优惠券(<span class="red">{{count}}</span>)</div>','<div class="table-wrap">',"<table></table>","</div>"].join(""),d=["<tr>",'<td class="col-1"><input id="Checkbox1" type="checkbox" name="couponChk" data-price="{{price}}" data-id="{{id}}" /></td>','<td class="col-2"><span class="red">{{price}}</span> 元</td>','<td class="col-3">{{name}}</td>','<td class="col-4">有效期至{{endTime}}</td>','<td class="col-5">满{{limitPrice}}减{{price}}</td>',"</tr>"].join("");window.dlgClone=$.extend(!0,{},JRJ.Dialogs);var p={PORTFOLIO:1,GIFT:2,VIEWPOINT:3,REWARD:4,REFERENCE:6,VOTE:8,GLANCE:9},l={Failed:-1,Free:1,Existed:2,GoPay:3},u=0,m=!1,g={productId:"",productName:"",type:"",checkOrderUrl:"",tgid:"",num:"",rmb:"",uniqueid:"",month:""},y={leadingZero:function(e,t){var n="000000000"+e;return n.substr(n.length-t)},dateFormat:function(e,t){if(!e.valueOf())return"";var n=e;return t.replace(/(yyyy|mm|dd|hh|nn|ss)/gi,function(e){switch(e.toLowerCase()){case"yyyy":return n.getFullYear();case"mm":return y.leadingZero(n.getMonth()+1,2);case"dd":return y.leadingZero(n.getDate(),2);case"hh":return y.leadingZero((h=n.getHours()%12)?h:12,2);case"nn":return y.leadingZero(n.getMinutes(),2);case"ss":return y.leadingZero(n.getSeconds(),2)}})},cutoff:function(e,t){if(0==t)return e;var n=e.replace(/[^\x00-\xff]/g,"**"),a=n.substring(0,t),s=a.split("*").length-1,i=s/2;t-=i;var c=e.substring(0,t),r="";return r=t<e.length?c+"...":c}},b=function(){dlgClone.close(),dlgClone.isShow=!1,dlgClone.standardDialog({title:"支付提示",width:450,content:['<div class="revenue-dlg-payment">','<p class="mt20">支付完成前 请不要关闭此支付验证窗口</p>','<p class="mt10"><strong>请在2小时内支付，超时将关闭订单；</strong></p>','<p class="mt10"><a class="btn btn-106-30-gray mr10" href="/site/help.html?tag=pay" target="_blank">支付遇到问题</a><a class="btn btn-97-30" id="finishPay">支付完成</a></p>',"</div>"].join(""),okBtnText:"确定",cancelBtnText:"取消",hasCloseBtn:!0,hasOkBtn:!1,hasBtn:!1,hasCancelBtn:!0,okCallback:function(){},cancelCallback:function(){location.href=location.href},isFixed:!0}),$("#finishPay").unbind("click").bind("click",function(){if(g.checkOrderUrl&&""!=g.checkOrderUrl){var e=g.checkOrderUrl;g.type!=p.VIEWPOINT&&g.type!=p.REWARD&&g.type!=p.VOTE&&g.type!=p.GIFT||(e=g.checkOrderUrl.indexOf("?")>0?g.checkOrderUrl+"&orderType="+g.type:g.checkOrderUrl+"?orderType="+g.type),$.ajax({url:e,type:"GET",data:{},dataType:"json",async:!1,success:function(e){e&&e.success?location.href=location.href:dlgClone.standardDialog({title:"支付提示",width:450,content:["<div>",'<p class="tc mt30">支付未完成，您可以去消费记录中继续支付</p>',"</div>"].join(""),okBtnText:"继续支付",cancelBtnText:"取消",hasCloseBtn:!0,hasOkBtn:!0,hasBtn:!0,hasCancelBtn:!1,okCallback:function(){location.href="/order/orderList.jspa"},cancelCallback:function(){},isFixed:!0})}})}})},f=function(e){$("#coupon-list").find('input[type="checkbox"]').click(function(){var t=$("#finalPrice"),n=$("#notice"),a=$("#btnCouponPay");$("#coupon-list").find('input[type="checkbox"]').not(this).prop("checked",!1);var s=parseInt($(this).attr("data-price"),10);if(2==e.pdType){var i=parseInt($("#original-disc").find("span").text(),10);$(this).is(":checked")?(i-s>0?(t.text(i-s),n.hide()):(t.text(0),n.show()),g.type==p.REFERENCE||g.type==p.PORTFOLIO||g.type==p.GLANCE?a.text(i-s>0?"立即支付":"立即订阅"):a.text("立即支付")):(t.text(i),n.hide(),a.text("立即支付"))}else $(this).is(":checked")?(u-s>0?(t.text(u-s),n.hide()):(t.text(0),n.show()),g.type==p.REFERENCE||g.type==p.PORTFOLIO||g.type==p.GLANCE?a.text(u-s>0?"立即支付":"立即订阅"):a.text("立即支付")):(t.text(u),n.hide(),a.text("立即支付"))}),$("#long-term-month").on("click","li",function(){$(this).css("border-color","#ff5050").addClass("month-border").siblings().css("border-color","#dbdbdb").removeClass("month-border");var t=$(this).index(),n=e.tipsDisCountVos[t].discountPrice/100,a=e.tipsDisCountVos[t].originalPrice/100,s=e.tipsDisCountVos[t].discount;s>=1?$(".line").hide():$(".line").show(),$("#original-disc").find("span").html(n).next().html(a+"元");var i=e.tipsDisCountVos[t],c=i.beginTime,r=i.endTime;$(".start-time").html(c),$(".end-time").html(r);for(var o=0;o<e.items.length;o++){var d=e.items[o].limitPrice;n>=d?($("#coupon-list").find('input[type="checkbox"]').eq(o).attr("disabled",!1),$("#coupon-list").find("tr").eq(o).find("*").css("color","#666").find("span").addClass("red")):($("#coupon-list").find('input[type="checkbox"]').eq(o).attr("disabled",!0),$("#coupon-list").find("tr").eq(o).find("*").css("color","#999").find(".red").removeClass("red"))}var p=$("#original-disc").find("span").text();$("#finalPrice").text(p),$("#coupon-list").find('input[type="checkbox"]').not(this).prop("checked",!1)}),$("#long-term-month>li:last").click(),$("#btnCouponPay").click(function(e){if(e.preventDefault(),!$("#chkAgreement").is(":checked"))return void JRJ.MiniAlerts.prompt({message:"<p>请勾选并同意服务协议</p>"});if($("#chkAgreement2").length>0&&!$("#chkAgreement2").is(":checked"))return void JRJ.MiniAlerts.prompt({message:"<p>请勾选并同意服务协议</p>"});if(!m){m=!0;var n=$("#coupon-list").find('input[type="checkbox"]:checked').attr("data-id"),i=$(".month-border").attr("data-month");switch(g.type){case p.PORTFOLIO:case p.REFERENCE:window.open(t.replace(/({pid}|{cid}|{type}|{month})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return g.productId;case"{cid}":return n||"";case"{type}":return g.type;case"{month}":return i||""}}));break;case p.GLANCE:window.open(t.replace(/({pid}|{cid}|{type}|{month})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return g.productId;case"{cid}":return n||"";case"{type}":return g.type;case"{month}":return i||""}}));break;case p.GIFT:case p.REWARD:case p.VIEWPOINT:window.open(a.replace(/({pid}|{cid}|{type}|{tgid}|{num}|{rmb}|{uniqueid})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return g.productId;case"{cid}":return n||"";case"{type}":return g.type;case"{tgid}":return g.tgid;case"{num}":return g.num;case"{rmb}":return g.rmb;case"{uniqueid}":return g.uniqueid}}));break;case p.VOTE:window.open(s.replace(/({pid}|{cid}|{type}|{tgid}|{num}|{rmb}|{uniqueid}|{content})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return g.productId;case"{cid}":return n||"";case"{type}":return g.type;case"{tgid}":return g.tgid;case"{num}":return g.num;case"{rmb}":return g.rmb;case"{uniqueid}":return g.uniqueid;case"{content}":return g.content}}))}b()}})},k=function(t){switch(t.type){case p.PORTFOLIO:return e.replace("{pid}",t.productId).replace("{type}",p.PORTFOLIO);case p.REFERENCE:return e.replace("{pid}",t.productId).replace("{type}",p.REFERENCE);case p.GLANCE:return e.replace("{pid}",t.productId).replace("{type}",p.GLANCE);case p.GIFT:case p.REWARD:case p.VIEWPOINT:return n.replace(/({pid}|{type}|{tgid}|{num}|{rmb}|{content})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return t.productId;case"{type}":return t.type;case"{tgid}":return t.tgid;case"{num}":return t.num;case"{rmb}":return t.rmb;case"{content}":return t.content||""}});case p.VOTE:return n.replace(/({pid}|{type}|{tgid}|{num}|{rmb}|{content})/gi,function(e){switch(e.toLowerCase()){case"{pid}":return t.productId;case"{type}":return t.type;case"{tgid}":return t.tgid;case"{num}":return t.num;case"{rmb}":return t.rmb;case"{content}":return t.content||""}})}},v=function(e){switch(e.amount=e.amount/100,e.startTime=y.dateFormat(new Date(parseInt(e.startTime,10)),"yyyy-mm-dd"),e.endTime=y.dateFormat(new Date(parseInt(e.endTime,10)),"yyyy-mm-dd"),g.type){case p.PORTFOLIO:(e.matchid||0)>0?e.note="注意事项：付款后即可接收该组合的调仓信息，跟单更快速。大师赛组合没有目标收益和退款机制，请确认后购买。":e.note="订阅须知：运行过程中，组合清仓后达到目标收益时可提前结束运行。若组合触及止损或到期未达到目标收益，视为失败，将于组合完成后的7~15个工作日内全额退款。";break;case p.GLANCE:e.note="支付须知：支付无悔，概不退款，支付成功后30分钟内可以随时查看组合持仓、调仓记录和互动等内容。";break;case p.REFERENCE:e.note="订阅须知：此内容仅代表个人研究成果，供学习参考，不是投资依据，据此操作风险自担。";break;case p.VIEWPOINT:e.pname=y.cutoff(g.productName,30)}return e},C=function(e){m||(m=!0,g=$.extend(g,e),$.ajax({url:k(g),dataType:"jsonp",type:"get",cache:!1,timeout:5e3,success:function(e){if("undefined"!=typeof e&&null!=e){switch(e.retCode){case l.Free:JRJ.MiniAlerts.prompt({message:"<p>订阅成功！</p>"});break;case l.GoPay:e=v(e),u=e.amount;var t="";if(6==g.type?t=Mustache.render(c,e):1==g.type?(e.ismaster=(e.matchid||0)>0,t=Mustache.render(i,e)):g.type==p.GLANCE?(e.isGlance=!0,t=Mustache.render(i,e)):t=Mustache.render(r,e),dlgClone.standardDialog({title:"确认购买",customClass:"dialog-coupon-buy",width:520,content:t,okBtnText:"确定",cancelBtnText:"取消",hasBtn:!1,hasCloseBtn:!0,hasOkBtn:!0,hasCancelBtn:!1,okCallback:function(){},cancelCallback:function(){},isFixed:!0}),2==e.pdType){var n="",a=e.tipsDisCountVos;$.each(a,function(e,t){if(a[e].discount<1&&a[e].discount>0){var s=Math.round(10*a[e].discount*10)/10;n+='<li class="month-heightauto" data-month='+a[e].month+"><em>"+a[e].month+"个月</em><i>("+s+"折)</i><span></span></li>"}else n+='<li class="month-height45" data-month='+a[e].month+"><em>"+a[e].month+"个月</em><i></i><span></span></li>"}),$("#long-term-month").html(n),$("#long-term-month").find("li:last").addClass("month-red")}else $("#long-term-month").hide();if(e.items.length>0){for(var s=$(Mustache.render(o,{count:e.items.length})),m=0;m<e.items.length;m++){var h=$(Mustache.render(d,e.items[m]));s.find("table").append(h),0==e.items[m].limitPrice&&s.find("table").find(".col-5").eq(m).html("无金额门槛")}$("#coupon-list").html(s)}e.items.length>4?$(".dialog-coupon-buy .coupon-list .table-wrap").css({height:"176px"}):$(".dialog-coupon-buy .coupon-list .table-wrap").css({height:"auto"}),f(e);break;case l.Existed:JRJ.Alerts.alert({message:e.msg||"订单已存在， 请前往订单列表支付。",autoClose:!1,okCallback:function(){window.location.href=e.redirectUrl}});break;case l.Failed:JRJ.Alerts.alert({message:e.msg||"订阅失败，请重试。",autoClose:!1})}/*g.type!=p.GLANCE&&g.type!=p.PORTFOLIO&&g.type!=p.REFERENCE||1!=e.evaluated||JRJ.usability.show()*/}},complete:function(e,t){m=!1,window.console&&console.log(t+"<<<<<<<<<<<<<<<<<<<<<")}}))},w=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return{show:C,guid:w}}();