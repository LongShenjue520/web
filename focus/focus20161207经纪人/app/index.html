<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,initial-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="format-detection" content="telephone=no" />
  <title>经纪人</title>
  <meta name="Keywords" content="" />
  <meta name="Description" content="" />

<style>
*{-webkit-tap-highlight-color:rgba(0,0,0,0);}
body, div, p, h1, h2, h3, h4, h5, h6, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, table, th, td { margin: 0; padding: 0; }
address, cite, em, i { font-style: normal; }
body{ -webkit-appearance: none;}
li { list-style: none; }
a {  text-decoration: none; }
img{ vertical-align: top; border: 0;  }
input[type="button"], input[type="submit"], input[type="reset"] { cursor: pointer; }
input{outline: none;border: none; background-color:transparent;  
appearance:none;-moz-appearance:none;-webkit-appearance:none;}
html,body{font:20px/1rem 'Microsoft Yahei';color:#878C92; }
body{background:url(img/background.png) no-repeat; background-size: 100% 100%;}
.clearfix:after{ display: block;content: ''; clear: both;}
.fl{ float: left;}
.fr{ float: right;}
.bsbb{ box-sizing:border-box;} 
.hide{ display:none !important;}
.show{ display:block !important;}
header{padding-top:1.925rem;}
.pic{ width: 3.7rem; height: 3.7rem; margin: 0 auto;border:3px solid #fff; border-radius: 50%; }
.pic img{ width: 100%; border-radius: 50%; }
.msg{ text-align: center; padding-top: 1rem;}
.msg span{ font-size: .7rem; color: #999;}
.msg b{ font-size: .9rem; color: #333;}
.tip{ width: 16rem; height: 3rem; background: url(img/qibao.png) no-repeat; margin: 0 auto; margin-top: .9rem;  background-size: 100% 100%;}
.tip p{ font-size: .6rem; color: #fff; line-height: .9rem; margin:0 1rem; padding-top: .6rem;}
.dec{ color: #999; line-height: .9rem; font-size: .6rem; padding:.8rem 2.6rem 0; position: relative;}
.dec .icon_l{ position: absolute;top: .8rem;left: 1.7rem;color: #EF570F;  font-size: .8rem; }
.dec .icon_r{ color: #EF570F;  font-size: .8rem; margin-top: 5px; }
.info{ width: 15.6rem; margin: 2rem auto 0;}
.info li{ margin-top: .5rem;}
.phone{ position: relative;border: 1px solid #DBDBDB;background: #fff;}
.info .phone input{ border:none; width:60%; }
.phone .closetel{ position: absolute;width:3rem; height:3rem;  top:-.7rem;  right:-.6rem; }
.phone .closetel i{  background:url(img/close.png); background-size: 100% 100%; display: block;width: .8rem; height: .8rem; margin:0 auto;     margin-top: 1.5rem;display:none;}
.info input{ font-size: .75rem; padding-left: .5rem; width:100%; border:1px solid #DBDBDB; height: 2.3rem; background: #fff; box-sizing:border-box; }
.code input{ width: 10rem;}
.btncode{ width: 5.25rem; line-height: 2.25rem; background: #EF570F ; color: #fff; font-size: .7rem; float: right; text-align: center; border-radius: 4px;}
.dis{ background: #DBDBDB;}
.submitbtn{display: block; text-align: center; line-height: 2.5rem; border:1px solid #EF570F; color: #EF570F; background: rgb(255,255,255); border-radius: 4px; font-size: .8rem;}
.submitbtn.dis{ opacity: 0.6; }
/*弹窗*/
.focus-dlg {position:fixed;top:0;left:0;width:100%;height:100%;z-index:2000;opacity:0;visibility:hidden;-moz-transform:scale(.5);-ms-transform:scale(.5);-o-transform:scale(.5);-webkit-transform:scale(.5);transform:scale(.5);-moz-transition:transform .3s cubic-bezier(.17,.67,.42,1.22);-o-transition:transform .3s cubic-bezier(.17,.67,.42,1.22);-webkit-transition:transform .3s cubic-bezier(.17,.67,.42,1.22);transition:transform .3s cubic-bezier(.17,.67,.42,1.22);display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center;}
.md-dialog-show .focus-dlg {visibility:visible;opacity:1;-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);-webkit-transform:scale(1);transform:scale(1);}
.md-dialog-show .md-overlay {opacity:1;visibility:visible;-moz-transition:all 1s;-o-transition:all 1s;-webkit-transition:all 1s;transition:all 1s;}
.dlg-con .zhuanjian{ font-size: .7rem; padding: .5rem 1rem;}
.md-overlay {position:fixed;width:100%;height:100%;visibility:hidden;top:0;left:0;z-index:1000;opacity:0;background:rgba(0,0,0,0.75);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr='#50000000',EndColorStr='#50000000');-webkit-transition:all .3s;-moz-transition:all .3s;transition:all .3s;}
.dlg-con {background:#f5f5f5;width:87%;border-radius:4px;position:relative;padding-bottom:3rem;}
.dlg-con .dlg-btn-wrap {width:100%;position:absolute;bottom:0;left:0;border-top:1px solid #d5d5d5;}
.layout-box {display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;display:flexbox;display:box;}
.dlg-con .dlg-btn:first-child {border-right:1px solid #d5d5d5;}
.dlg-con .dlg-btn {height:2.475rem;line-height:2.475rem;text-align:center;font-size:.8rem;color:#3996F2;-webkit-box-flex:1;-webkit-flex:1;-moz-flex:1;-ms-flex:1;flex:1;}
.dlg-con .msg { display: none;}
.dlg-con .msg span{ margin: 1.5rem .25rem 0 1.5rem; font-size: .7rem;}
.dlg-con .msg ul{ margin-top: 1.3rem;}
.dlg-con .msg li{  font-size: .8rem; line-height: 1.2rem;}
.codeimgbox{ padding:1.8rem 2rem; }
.codeimgbox input{font-size: .75rem; padding-left: .5rem; width:6rem; border:1px solid #d5d5d5; height: 2.3rem; background: #fff; box-sizing:border-box; border-radius: 4px;}
.codeimgbox img{ float: right; width: 5.25rem; height: 2.3rem }
.tiperror{z-index:9999; width: 13rem; line-height: 2.5rem; background: rgba(0,0,0,.68); border-radius: 4px; color: #fff; font-size: .8rem; text-align: center; position: fixed;top: 50%; left: 50%; margin-left: -6.5rem; margin-top: -1.25rem; display: none;}
.phonenum{ime-mode:disabled; ondragenter:expression(ondragenter=function(){return false;}); onpaste:expression(onpaste=function(){return false;}); } 
.errorboxbtn{z-index: 9999;  width:0; height:100%; background:rgba(0,0,0,0.75);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr='#50000000',EndColorStr='#50000000'); position: fixed; top:0; left:0;display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center; overflow: hidden;}
.errorin{ background: #f5f5f5;width: 89.3%;border-radius: 4px; text-align: center; }
.errorin h3{ padding:2.5rem 0; font-size: .8rem;color: #F24637; font-weight: normal;}
.errorin span{border-top: 1px solid #d5d5d5; display: block;line-height: 3rem;font-size: .8rem;color: #3996F2;}
</style>
  <body>
     <header>
       <div class="pic"><img src="img/img1.png" class="picimg"></div>
       <div class="msg">
         <span>hi,我是</span>
         <b class="agentName"></b>
     </div>
     <div class="tip"><p>邀请您在平安证券开户，万2.5佣金，开户交易即送50元话费+level 2 一年免费使用权。</p></div>
     <p class="dec"><em class="icon_l">“</em><span>开户后，我就是您的专属经纪人了，提供7*24小时股票咨询服务，股票问题都可以找我！</span><em class="icon_r">”</em></p>
 </header> 
 <ul class="info">
   <li class="phone">
     <input type="tel" placeholder="请输入您的手机号码" name="num" class="phonenum" autocomplete="off"  maxlength="11" /><em class="closetel"><i></i></em>
 </li>
 <li class="code clearfix">
     <input type="text" class="fl codenum" placeholder="请输入验证码"  maxlength="4" /><span class="btncode dis">获取验证码</span>
 </li>
 <li>
     <a href="javascript:;" class="submitbtn dis">去开户</a>
 </li>
</ul>
<!--验证码弹窗-->
<div class="focus-dlg">
    <div class="dlg-con">
      <div class="codeimgbox clearfix">
        <input type="text" class="fl" placeholder=""  maxlength="4" />
    </div>
    <div class="dlg-btn-wrap layout-box">
        <a class="dlg-btn dlg-close">取消</a>
        <a class="dlg-btn submit">确认</a>
    </div>
</div>
</div>
<div class="md-overlay"></div> 
<!--错误弹窗，一会儿消失-->
<div class="tiperror"></div>
<!--错误弹窗，有确定按钮，用户要点击-->
<div class="errorboxbtn"><div class="errorin"><h3></h3><span>确定</span></div></div>
<script src="https://js.jrjimg.cn/zqt-red-1000/js/jquery-1.7.2.min.js"></script>   
<script src="https://i0.jrjimg.cn/zqt-red-1000/focus/common/js/fastclick.js"></script>
<script>
  /*测试，一
    /*计算字体大小*/
    function change(){
        document.documentElement.style.fontSize = 20 * document.documentElement.clientWidth / 375 + 'px';
    }
    change();
    if ('addEventListener' in document) {
        document.addEventListener('DOMContentLoaded', function () 
        {
           FastClick.attach(document.body);
        }, false);
    }
    window.addEventListener('resize', change, false);
    var domain = 'https://t.jrj.com.cn';
    var btncode = $('.btncode');//获取验证码按钮
    var phonenum = $('.phonenum');// 手机输入框
    var codenum = $('.codenum');//手机短信验证码输入框
    var submitbtn = $('.submitbtn');//去开户按钮
    window.itgCode = getQueryString('itgCode'); //经纪人id 
 
    //获取用户信息
    userinfo();
    function userinfo(){
        $.ajax({
            type : "get", 
            url : domain+'/sapi/v3/userAgent/getAgentInfo?itgCode='+itgCode, 
            dataType : "json",
            success : function (info){
                if (info.retcode == 0){
                    $('.agentName').html(info.data.agentName);
                    $('.picimg').attr('src', info.data.url);
                }else{
                    tiperror(info.msg);
                }
            }
        });
    }
    //发送短信
    btncode.click(function (){
        if (phonenum.val().length==0) {
            tiperror('请输入手机号');
            return;
        }
        if (!/^1[34578]\d{9}$/.test(phonenum.val())) {
            tiperror('请输入合理的手机号');
            return;
        }
        if ($(this).hasClass('dis')) {
            return;
        }
        time60s();
        sendmesfn1();
    });
    var codeimgkey;
    function imgCode(v){
      codeimg(v.data.image);
      codeimgkey=v.data.key;
    }
    function getimgcode(){
        $('body').addClass('md-dialog-show');
        $('.codeimgbox input').val('');
        if($('.codeimgbox img')){$('.codeimgbox img').remove()};
        $.ajax({
            type : "get", 
            url : domain+'/sapi/v3/userAgent/getImgCode?phone='+phonenum.val()+'&itgCode='+itgCode+'&callback=imgCode', 
            dataType : "jsonp"
            
        });
    }
    //图片验证码上的按钮
    $('.submit').click(function (){
        //要修改 
        if ($('.codeimgbox input').val().length<4) {
            tiperror('验证码输入错误');
            return;
        }
        sendmesfn2();
        
    });
    $('.dlg-close').click(function (){
        $('body').removeClass('md-dialog-show');
    });
    //去开户
    submitbtn.click(function (e){
        
        if (phonenum.val().length==0) {
            tiperror('请输入手机号');
            return;
        }
        
        if (!/^1[34578]\d{9}$/.test(phonenum.val())) {
            tiperror('请输入合理的手机号');
            return;
        }
        if (codenum.val().length==0) {
            tiperror('请输入验证码');
            return;
        }
        if (codenum.val().length<4) {
            tiperror('验证码输入错误');
            return;
        }
        if ($(this).hasClass('dis')) {return;}
        //绑定接口
        $.ajax({
            type : "get", 
            url : domain+'/sapi/v3/userAgent/saveBindInfo?phone='+phonenum.val()+'&itgCode='+itgCode+'&smsg='+codenum.val(), 
            dataType : "json",
            success : function (info){
                console.log(info);
                if (info.retcode == 0){
                    //跳转下载app
                    window.location.href='https://i0.jrjimg.cn/zqt-red-1000/focus/focus20161116-gosignup/openaccount.html';
                }else if(info.retcode == -4){
                    errorboxbtn('您已绑定过此经纪人，请勿重复绑定');
                }else if(info.retcode == -2){
                    tiperror('不曾给用户发过短信');
                }else if(info.retcode == -5 || info.retcode == -6){
                    tiperror('服务器繁忙，请稍后再试');
                }else if(info.retcode == -7){
                    tiperror('验证码不正确');
                }
            }
        });
    });
    //处理输入框右边的小XX
    phonenum.keyup(function (){
        var c = $(this);
        if (/[^\d]/.test(c.val())) {
            //替换非数字字符  
            var temp_amount = c.val().replace(/[^\d]/g, '');
            $(this).val(temp_amount);
        }
        if ($(this).val().length == 0) {
            $('.closetel i').css('display','inline');
        }
        else {
            $('.closetel i').css('display','block');
        }
        if ($(this).val().length == 11) {
            btncode.removeClass('dis');
        }
        else {
            btncode.addClass('dis');
        }
        submitbtnstatus();
    });
    phonenum.focus(function (){
        if ($(this).val().length == 0) {
            $('.closetel i').css('display','inline');
        }
        else {
            $('.closetel i').css('display','block');
        }
    });
    $('.closetel').unbind().click(function (){
       phonenum.val('');
       $('.closetel i').css('display','inline');;        
       btncode.addClass('dis');
       phonenum.focus();
    });
    phonenum.blur(function (){
        $('.closetel i').css('display','inline');
    });
    codenum.keyup(function (){
        submitbtnstatus();
    });
    //点击图片验证码换图片
    $('.codeimgbox').delegate('img','click',function(){
        $('.codeimgbox img').remove();
        getimgcode();
    });
    //点击错误提示框按钮
    $('.errorboxbtn span').click(function(){
        $('.errorboxbtn').css('width','0');
    });
    //发验证时间60s
    function time60s(){
        var nums = 60;
        btncode.addClass('dis');
        btncode.html('重新获取(' + nums + 's)');
        var timer = setInterval(function ()
        {
            nums--;
            btncode.html('重新获取(' + nums + 's)');
            if (nums ==- 1) {
                clearInterval(timer);
                btncode.removeClass('dis').html('获取验证码');
            }
        }, 1000);
    }
    //验证去开户按钮的状态
    function submitbtnstatus(){
        if (phonenum.val().length == 11 && codenum.val().length == 4) {
            submitbtn.removeClass('dis');
        }
        else {
            submitbtn.addClass('dis');
        }
    }
    //发送短信请求1
    function sendmesfn1(){
        var phone = phonenum.val();
        $.ajax(
        {
            type : "get", 
            url : domain + '/sapi/v3/userAgent/sendAgentMessage?phone=' + phone + '&itgCode=' + itgCode, 
            dataType : "json",
            success : function (info){
                console.log(info);
                if(info.retcode == 0) {
                    //alert('成功');
                }else if(info.retcode == -3){
                    getimgcode();
                }else if(info.retcode == -4){
                    errorboxbtn('您已绑定过此经纪人，请勿重复绑定');
                }else if(info.retcode == -2 || info.retcode == -7  ||info.retcode == -9  ||info.retcode == -10 ){
                    tiperror(info.msg);
                }
            }
        });
    }
    //发送短信请求2+图片码
    function sendmesfn2(){
        var phone = phonenum.val();
        $.ajax(
        {
            type : "get", 
            url : domain + '/sapi/v3/userAgent/sendAgentMessage?phone=' + phone + '&itgCode=' + itgCode+'&key='+codeimgkey+'&captchaCode='+$('.codeimgbox input').val(), 
            dataType : "json",
            success : function (info){
                console.log(info);
                if(info.retcode == 0) {
                    $('body').removeClass('md-dialog-show');
                }else if(info.retcode == -3){
                    getimgcode();
                }else if(info.retcode == -4){
                    errorboxbtn('您已绑定过此经纪人，请勿重复绑定');
                }else if(info.retcode == -2 || info.retcode == -7  ||info.retcode == -9  ||info.retcode == -10 ){
                    tiperror(info.msg);
                }
            }
        });
    }
    //生成验证码图片
    function codeimg(str){
        var oImg = new Image();
        oImg.src = 'data:image/jpg;base64,' + str;
        $('.codeimgbox').append(oImg);
    }
    //错误提示框，一会儿就消失
    function tiperror(msg){
        $('.tiperror').html(msg).show();
        setTimeout(function (){
            $('.tiperror').hide();
        }, 2000);
        return;
    } 
    function errorboxbtn(str){
        $('.errorboxbtn').width('100%');
        $('.errorin h3').html(str);
    }
    function getQueryString( name ){
        var reg = new RegExp("(^|&|/?)" + name + "=([^&]*)(&|$)", "i");
        var r = encodeURI(window.location.search||window.location.href).substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }
</script> 

</body>
</html>